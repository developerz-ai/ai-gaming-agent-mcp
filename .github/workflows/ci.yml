name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  CI: true  # Signals to skip integration tests

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v5

      - name: Set up Python
        run: uv python install 3.12

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y xvfb scrot python3-tk python3-dev

      - name: Install dependencies
        run: uv sync --extra dev

      - name: Lint with ruff
        run: uv run ruff check src tests

      - name: Run unit tests (skip integration)
        run: uv run pytest tests/ --ignore=tests/integration -v

  # Integration tests are LOCAL ONLY - they require a real display
  # Run locally with: uv run pytest tests/integration -v
  #
  # Why integration tests can't run in CI:
  # - Require real display (X11/Wayland/Windows/macOS desktop)
  # - Perform actual mouse movements and clicks
  # - Open real applications (terminals)
  # - Need tesseract-ocr for OCR verification
  # - Could interfere with other processes
